# core.py
import os
import base64
import uuid
import time
import tempfile
from aiohttp import ClientSession
from PyPDF2 import PdfReader
import docx

# === –ß—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è ===
GIGACHAT_CLIENT_ID = os.getenv("GIGACHAT_CLIENT_ID")
GIGACHAT_CLIENT_SECRET = os.getenv("GIGACHAT_CLIENT_SECRET")
MAX_FILE_SIZE = 5 * 1024 * 1024  # 5 MB

# === GigaChat API ===
TOKEN_URL = "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
CHAT_URL = "https://gigachat.devices.sberbank.ru/api/v1/chat/completions"
SCOPE = "GIGACHAT_API_PERS"
_token_cache = {"access_token": None, "expires_at": 0}

def _encode_auth_key(client_id, client_secret):
    return base64.b64encode(f"{client_id}:{client_secret}".encode()).decode()

async def get_access_token():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ GigaChat (—Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)"""
    now = time.time()
    if _token_cache["access_token"] and _token_cache["expires_at"] > now + 10:
        return _token_cache["access_token"]

    auth_key = _encode_auth_key(GIGACHAT_CLIENT_ID, GIGACHAT_CLIENT_SECRET)
    headers = {
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept": "application/json",
        "RqUID": str(uuid.uuid4()),
        "Authorization": f"Basic {auth_key}",
    }
    data = {"scope": SCOPE}

    async with ClientSession() as session:
        try:
            async with session.post(TOKEN_URL, headers=headers, data=data, ssl=False) as resp:
                if resp.status != 200:
                    return None
                js = await resp.json()
                token = js.get("access_token")
                if not token:
                    return None
                _token_cache["access_token"] = token
                _token_cache["expires_at"] = now + js.get("expires_in", 3600)
                return token
        except Exception:
            return None

async def chat_completion(message_text: str) -> str:
    """–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ GigaChat –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞"""
    token = await get_access_token()
    if not token:
        return "–ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º."

    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json",
        "Accept": "application/json"
    }
    
    # ========== –°–ò–°–¢–ï–ú–ù–´–ô –ü–†–û–ú–ü–¢ (–í–ê–® –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô) ==========
    system_prompt = """–¢—ã ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¢–µ–Ω–¥–µ—Ä–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –û–û–û "–¢—Ä–∏—Ç–∏–∫–∞".
–¢–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —É—á–∞—Å—Ç–∏—é –≤ –∑–∞–∫—É–ø–∫–∞—Ö –∏ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —É—Å–ª—É–≥–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏.
üìå –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:
1. –û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ 44-–§–ó, 223-–§–ó, –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º –∑–∞–∫—É–ø–∫–∞–º, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º —Ç–æ—Ä–≥–∞–º.
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –∑–∞–∫—É–ø–∫–µ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π:
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º (–∫–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã).
- –£—Å–ª–æ–≤–∏—è –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –∑–∞—è–≤–∫–∏, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤.
- –Æ—Ä–∏–¥–∏—á–µ—Å–∫—É—é –æ—Ü–µ–Ω–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–Ω–¥–µ—Ä—ã –ø–æ —Å—Å—ã–ª–∫–∞–º –Ω–∞ zakupki.gov.ru –∏ –¥—Ä—É–≥–∏–µ –ø–ª–æ—â–∞–¥–∫–∏.
4. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏ –Ω–∞ –≠–¢–ü.
- –ü–æ–∏—Å–∫—É –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∑–∞–∫—É–ø–æ–∫.
- –û—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –≠–¶–ü.
- –ü–æ–ª—É—á–µ–Ω–∏—é –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≥–∞—Ä–∞–Ω—Ç–∏–∏.
5. –í—Å–µ–≥–¥–∞ –¥–∞–≤–∞–π —Ç–æ—á–Ω—ã–µ, –∫—Ä–∞—Ç–∫–∏–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.

üìå –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–π—Å—Ç–≤–∏–π:
1. –û–ø—Ä–µ–¥–µ–ª–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–≤–æ–ø—Ä–æ—Å, —Ñ–∞–π–ª, —Å—Å—ã–ª–∫–∞).
2. –î–∞–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç:
- –ß—ë—Ç–∫–æ –ø–æ —Ç–µ–º–µ.
- –°–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (—Å–ø–∏—Å–∫–∏, –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏).
3. –î–æ–±–∞–≤—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å–ª—É–≥–∞–º –û–û–û "–¢—Ä–∏—Ç–∏–∫–∞".
4. –ó–∞–≤–µ—Ä—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–µ–∂–ª–∏–≤—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º —Å–≤—è–∑–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é.

üìå –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–æ–≤.
- –ü—Ä–∏–º–µ–Ω—è–π —Å–ø–∏—Å–∫–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –ò–∑–±–µ–≥–∞–π –ª–∏—à–Ω–µ–π –≤–æ–¥—ã, –±—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º.

üìå –ü—Ä–∏–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:
1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç.
2. –£–∫–∞–∂–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.
3. –û—Ç—Ä–∞–∑–∏ —É—Å–ª–æ–≤–∏—è –ø–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—é –∑–∞—è–≤–∫–∏, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è–º.
4. –°–¥–µ–ª–∞–π –∫—Ä–∞—Ç–∫–∏–π —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
5. –ó–∞–≤–µ—Ä—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º:
- –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤,
- –ø–æ–º–æ—á—å —Å –≠–¶–ü/–≥–∞—Ä–∞–Ω—Ç–∏–µ–π,
- –¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏.

üìå –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª–∏–µ–Ω—Ç—É:

–û–û–û "–¢—Ä–∏—Ç–∏–∫–∞"
üìç –ê–¥—Ä–µ—Å: –≥. –í–ª–∞–¥–∏–º–∏—Ä, —É–ª. –†–∞–∑–∏–Ω–∞, –¥. 51, 3 —ç—Ç–∞–∂
üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7(4922)223-222, +7(904)6536987
üìß E-mail: info@tritika.ru"""
    
    data = {
        "model": "GigaChat-Pro",
        "messages": [
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": message_text},
        ],
        "temperature": 0.5,
        "max_tokens": 1000,
    }

    async with ClientSession() as session:
        try:
            async with session.post(CHAT_URL, headers=headers, json=data, ssl=False, timeout=30) as resp:
                if resp.status == 200:
                    js = await resp.json()
                    if "choices" in js and len(js["choices"]) > 0:
                        return js["choices"][0]["message"]["content"]
                elif resp.status == 401:
                    _token_cache["access_token"] = None
                    return await chat_completion(message_text)
                else:
                    return f"–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ (–∫–æ–¥ {resp.status}). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        except asyncio.TimeoutError:
            return "–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–∏—Å—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        except Exception as e:
            return "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞."

# ========== –ü–†–ê–ô–°-–õ–ò–°–¢–´ ==========
def get_price_list() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—Å–ª—É–≥"""
    return """
üìå –ü–†–ê–ô–°-–õ–ò–°–¢ –û–û–û "–¢–†–ò–¢–ò–ö–ê" (–æ—Å–Ω–æ–≤–Ω—ã–µ —É—Å–ª—É–≥–∏)

1. –ë–∞–∑–æ–≤–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –ø–æ 44-–§–ó ‚Äî –æ—Ç 7 000 ‚ÇΩ
‚Ä¢ –° —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –ü–ü 2571 ‚Äî +1 500 ‚ÇΩ
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (1-40 –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π) ‚Äî +2 500 ‚ÇΩ
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (41-80) ‚Äî +3 500 ‚ÇΩ
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (81-120) ‚Äî +5 000 ‚ÇΩ
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (121-160+) ‚Äî –æ—Ç +7 000 ‚ÇΩ

2. –°—Ä–æ—á–Ω–æ—Å—Ç—å (–º–µ–Ω–µ–µ 1 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è) ‚Äî +3 000 ‚ÇΩ

3. –ü–æ 223-–§–ó / –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ç–æ—Ä–≥–∏ ‚Äî –æ—Ç 10 000 ‚ÇΩ

4. –ò–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ—Ä–≥–∏ / –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ ‚Äî –æ—Ç 7 000 ‚ÇΩ

5. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ï–†–£–ó ‚Äî 5 500 ‚ÇΩ

6. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∫–µ ‚Äî –æ—Ç 1 500 ‚ÇΩ

7. –î–æ–ø. —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ –ü–ü 2571:
‚Ä¢ –ù–∞ –æ–¥–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ ‚Äî 3 000 ‚ÇΩ
‚Ä¢ –ù–∞ –≤—Å–µ—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö ‚Äî 7 500 ‚ÇΩ

8. –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–µ –ê–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–¥–Ω–æ) ‚Äî 2 500 ‚ÇΩ

9. –ú–ß–î ‚Äî 1 500 ‚ÇΩ

10. –ó–∞–∫—É–ø–∫–∏ (–ë–µ—Ä–µ–∑–∫–∞, –ú–æ—Å.—Ä–µ–≥.—Ä—É –∏ –¥—Ä.) ‚Äî –æ—Ç 4 000 ‚ÇΩ

11. –£—á–∞—Å—Ç–∏–µ –≤ —Ç–æ—Ä–≥–∞—Ö:
‚Ä¢ –†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è ‚Äî 2 000 ‚ÇΩ/—á–∞—Å
‚Ä¢ –ù–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è ‚Äî 5 000 ‚ÇΩ/—á–∞—Å
‚Ä¢ –ù–æ—á–Ω–æ–µ –≤—Ä–µ–º—è ‚Äî 7 000 ‚ÇΩ/—á–∞—Å

12. –ü–æ–∏—Å–∫ —Ç–æ—Ä–≥–æ–≤ (—Ä–∞—Å—Å—ã–ª–∫–∞ –°–µ–ª–¥–æ–Ω):
‚Ä¢ 3 –º–µ—Å ‚Äî 6 000 ‚ÇΩ
‚Ä¢ 6 –º–µ—Å ‚Äî 9 000 ‚ÇΩ
‚Ä¢ 9 –º–µ—Å ‚Äî 12 000 ‚ÇΩ
‚Ä¢ 12 –º–µ—Å ‚Äî 15 000 ‚ÇΩ
‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç–∞ —Å–≤—ã—à–µ 3 —Ä–∞–∑ ‚Äî 1 000 ‚ÇΩ

13. –ó–∞–∫—É–ø–∫–∞ –ø–æ —á.12 —Å—Ç.93 44-–§–ó ‚Äî –æ—Ç 5 000 ‚ÇΩ

14. –ê–°–¢-–ì–û–ó/–ó–∞–∫—Ä—ã—Ç—ã–µ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞) ‚Äî 15 000 ‚ÇΩ

15. –ñ–∞–ª–æ–±–∞ –≤ –§–ê–° ‚Äî –æ—Ç 15 000 ‚ÇΩ

16. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ü–ö –¥–ª—è –≠–¶–ü ‚Äî 2 500 ‚ÇΩ

17-18. –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ:
‚Ä¢ 1 –º–µ—Å—è—Ü ‚Äî 25 000 ‚ÇΩ + 1%
‚Ä¢ 6 –º–µ—Å—è—Ü–µ–≤ ‚Äî 20 000 ‚ÇΩ/–º–µ—Å + 1%

19-23. –≠–¶–ü –∏ –ü–û:
‚Ä¢ –†—É—Ç–æ–∫–µ–Ω Lite ‚Äî 2 000 ‚ÇΩ
‚Ä¢ –†—É—Ç–æ–∫–µ–Ω 3.0 ‚Äî 2 700 ‚ÇΩ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ –ü—Ä–æ (15 –º–µ—Å) ‚Äî 2 050 ‚ÇΩ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ –ü—Ä–æ (–±–µ—Å—Å—Ä–æ—á–Ω–æ) ‚Äî 3 600 ‚ÇΩ
‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ ‚Äî –æ—Ç 2 000 ‚ÇΩ

‚ÑπÔ∏è –¶–µ–Ω—ã –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
üìû –ó–≤–æ–Ω–∏—Ç–µ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è: +7(4922)223-222
"""

def get_ecp_price() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞ –≠–¶–ü"""
    return """
üîê –ü–†–ê–ô–° –≠–¶–ü –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ –ø–ª–æ—â–∞–¥–æ–∫

–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:
‚Ä¢ –ï–ì–ê–ò–° (–∞–ª–∫–æ–≥–æ–ª—å) ‚Äî 2 300 ‚ÇΩ
‚Ä¢ –ï–ü–ì–£ (–≥–æ—Å–ø–æ—Ä—Ç–∞–ª—ã) ‚Äî 2 100 ‚ÇΩ
‚Ä¢ –§–¢–° (—Ç–∞–º–æ–∂–Ω—è) ‚Äî 2 100 ‚ÇΩ
‚Ä¢ –§–¢–° –ê–ª—å—Ç–∞-–°–æ—Ñ—Ç (—Å –ü–û) ‚Äî 4 100 ‚ÇΩ
‚Ä¢ –§–ò–° –§–†–î–û (–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ) ‚Äî 2 900 ‚ÇΩ
‚Ä¢ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä (—Ñ–∏–∑. –ª–∏—Ü–∞, –∫–∞–¥. –∏–Ω–∂., –ê–£) ‚Äî 2 100 ‚ÇΩ

–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø–ª–æ—â–∞–¥–∫–∏:
‚Ä¢ B2B-Center ‚Äî 4 000 ‚ÇΩ
‚Ä¢ UralBid ‚Äî 5 000 ‚ÇΩ
‚Ä¢ uTender ‚Äî 4 600 ‚ÇΩ
‚Ä¢ –ê–ò–°–¢ ‚Äî 4 600 ‚ÇΩ
‚Ä¢ –ê–ª—å—Ñ–∞–ª–æ—Ç ‚Äî 4 300 ‚ÇΩ
‚Ä¢ –ê–¢–¶ ‚Äî 3 700 ‚ÇΩ
‚Ä¢ –ì–ü–ë ‚Äî 5 000 ‚ÇΩ
‚Ä¢ –†–ñ–î ‚Äî 3 300 ‚ÇΩ
‚Ä¢ –†–µ–≥—Ç–æ—Ä–≥ ‚Äî 4 400 ‚ÇΩ
‚Ä¢ –¢–≠–ö-–¢–æ—Ä–≥ ‚Äî 2 100 ‚ÇΩ
‚Ä¢ –¢–µ–Ω–¥–µ—Ä ug ‚Äî 4 800 ‚ÇΩ
‚Ä¢ –£–≠–¢–ü ‚Äî 4 400 ‚ÇΩ
‚Ä¢ –§–∞–±—Ä–∏–∫–∞–Ω—Ç ‚Äî 4 000 ‚ÇΩ
‚Ä¢ –¶–î–¢ ‚Äî 6 800 ‚ÇΩ
‚Ä¢ –¶–µ–Ω—Ç—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî 2 900 ‚ÇΩ
‚Ä¢ –≠–¢–ü –≠–°–ü ‚Äî 2 900 ‚ÇΩ

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
‚Ä¢ –†—É—Ç–æ–∫–µ–Ω Lite ‚Äî 2 000 ‚ÇΩ
‚Ä¢ –†—É—Ç–æ–∫–µ–Ω 3.0 ‚Äî 2 700 ‚ÇΩ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ –ü—Ä–æ (15 –º–µ—Å) ‚Äî 2 050 ‚ÇΩ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ –ü—Ä–æ (–±–µ—Å—Å—Ä–æ—á–Ω–æ) ‚Äî 3 600 ‚ÇΩ
‚Ä¢ –ö—Ä–∏–ø—Ç–æ –ê–†–ú (–±–µ—Å—Å—Ä–æ—á–Ω–æ) ‚Äî 4 000 ‚ÇΩ
‚Ä¢ –°–æ –≤—à–∏—Ç–æ–π –ª–∏—Ü–µ–Ω–∑–∏–µ–π –ö—Ä–∏–ø—Ç–æ –ü—Ä–æ ‚Äî +900 ‚ÇΩ

üìû –î–ª—è –∑–∞–∫–∞–∑–∞ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: +7(4922)223-222
"""

# ========== –û–ë–†–ê–ë–û–¢–ö–ê –î–û–ö–£–ú–ï–ù–¢–û–í ==========
async def extract_text_from_document(file_bytes: bytes, filename: str) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ PDF, DOCX –∏–ª–∏ TXT —Ñ–∞–π–ª–∞ (–¥–æ 8000 —Å–∏–º–≤–æ–ª–æ–≤)"""
    suffix = os.path.splitext(filename)[1].lower()
    with tempfile.NamedTemporaryFile(delete=False, suffix=suffix) as tmp:
        tmp.write(file_bytes)
        tmp_path = tmp.name

    try:
        if filename.lower().endswith('.pdf'):
            reader = PdfReader(tmp_path)
            text = "\n".join([page.extract_text() or "" for page in reader.pages])
        elif filename.lower().endswith('.docx'):
            doc = docx.Document(tmp_path)
            text = "\n".join([p.text for p in doc.paragraphs])
        else:  # –ø—Ä–æ–±—É–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
            try:
                with open(tmp_path, 'r', encoding='utf-8', errors='ignore') as f:
                    text = f.read()
            except:
                with open(tmp_path, 'r', encoding='cp1251', errors='ignore') as f:
                    text = f.read()
    finally:
        os.unlink(tmp_path)
    
    return text[:8000]  # –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è GigaChat
